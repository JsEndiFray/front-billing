<div class="list-wrapper">
  <h2>Listado de Propiedades</h2>

  <!-- BARRA DE BÚSQUEDA -->
  <div class="search-container">
    <div class="search-wrapper">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        placeholder="Buscar por Referencia Catastro, dirección, localidad y provincia..."
        class="search-input"
      >
      <div class="search-actions">
        <span class="search-icon">🔍</span>
        @if (searchTerm && searchTerm.trim() !== '') {
          <button
            type="button"
            (click)="clearSearch()"
            class="clear-button"
            title="Limpiar búsqueda"
          >
            ✕
          </button>
        }
      </div>
    </div>
    @if (searchTerm && searchTerm.trim() !== '') {
      <div class="search-results-info">
        <span>Mostrando {{ estates.length }} de {{ allStates.length }} Inmuebles</span>
      </div>
    }
  </div>

  <table>
    <thead>
    <tr>
      <th>ID</th>
      <th>Ref. Catastral</th>
      <th>Precio</th>
      <th>Dirección</th>
      <th>C.P</th>
      <th>Localidad</th>
      <th>Provincia</th>
      <th>País</th>
      <th>Superficie</th>
      <th>Creado</th>
      <th>Actualizado</th>
      <th>Acciones</th>
    </tr>
    </thead>

    <tbody>
      @if (estates && estates.length > 0) {
        @for (estate of estates; track estate.id) {
          <tr>
            <td>{{ estate.id }}</td>
            <td>{{ estate.cadastral_reference }}</td>
            <td>{{ estate.price }} €</td>
            <td>{{ estate.address }}</td>
            <td>{{ estate.postal_code }}</td>
            <td>{{ estate.location }}</td>
            <td>{{ estate.province }}</td>
            <td>{{ estate.country }}</td>
            <td>{{ estate.surface }}</td>
            <td>{{ estate.date_create | dataFormat }}</td>
            <td>{{ estate.date_update | dataFormat }}</td>
            <td>
              <button (click)="editEstate(estate.id!)">Editar</button>
              <button (click)="deleteEstate(estate.id!)">Eliminar</button>
            </td>
          </tr>
        }
      } @else {
        <tr>
          <td colspan="12" class="no-clients-cell">
            <div class="no-clients-card">
              <h3>Sin Propiedades</h3>
              <p>No hay propiedades disponibles en este momento.</p>
            </div>
          </td>
        </tr>
      }
    </tbody>
  </table>
</div>
