<div class="container">
  <!-- T√≠tulo y descripci√≥n -->
  <div class="header">
    <h1 class="title">Gesti√≥n de Proveedores</h1>
    <p class="subtitle">Administra el listado completo de proveedores</p>
  </div>

  <!-- Secci√≥n de b√∫squeda -->
  <div class="filters-section">
    <!-- FormGroup de b√∫squeda -->
    <form class="search-container" [formGroup]="searchForm">
      <div class="search-wrapper">
        <input
          type="text"
          formControlName="searchTerm"
          placeholder="Buscar por nombre, empresa, CIF, email, ciudad..."
          class="search-input"
          autocomplete="off">
        <!-- Iconos de b√∫squeda y limpiar -->
        <div class="search-actions">
          <span class="search-icon">üîç</span>
          @if (searchForm.get('searchTerm')?.value) {
            <button type="button" (click)="clearFilters()" class="clear-button" title="Limpiar b√∫squeda">‚úï</button>
          }
        </div>
      </div>
    </form>
  </div>

  <!-- Filtros -->
  <div class="filters-container">
    <form [formGroup]="filtersForm">
      <!-- Filtro por estado -->
      <select formControlName="selectedActiveStatus" class="filter-select">
        <option value="">Todos los estados</option>
        @for (status of activeStatusLabels; track status.value) {
          <option [value]="status.value">{{ status.label }}</option>
        }
      </select>

      <!-- Filtro por t√©rminos de pago -->
      <select formControlName="selectedPaymentTerms" class="filter-select">
        <option value="">Todos los t√©rminos</option>
        @for (term of paymentTermsLabels; track term.value) {
          <option [value]="term.value">{{ term.label }}</option>
        }
      </select>

      <!-- Bot√≥n limpiar filtros -->
      <button
        type="button"
        (click)="clearFilters()"
        class="clear-filters-btn"
        title="Limpiar todos los filtros">
        Limpiar filtros
      </button>

    </form>

    <!-- Botones de acci√≥n -->
    <div class="actions-container">
      <button type="button" class="export-btn" (click)="exportData()">
        Exportar Todo
      </button>
      <button type="button" class="export-btn" (click)="exportCurrentPage()">
        Exportar P√°gina
      </button>
      <button type="button" class="export-btn" (click)="exportSelected()">
        Exportar Selecci√≥n ({{ selectedItems.size }})
      </button>
      <button type="button" class="primary-btn " (click)="createNewSupplier()">+ Nuevo Proveedor</button>
    </div>
  </div>

  <!-- Configuraci√≥n de paginaci√≥n -->
  <div class="pagination-config">
    <form [formGroup]="paginationForm">
      <label for="itemsPerPage">Elementos por p√°gina:</label>
      <select
        id="itemsPerPage"
        formControlName="itemsPerPage"
        class="items-per-page-select">
        <option [value]="5">5</option>
        <option [value]="10">10</option>
        <option [value]="25">25</option>
        <option [value]="50">50</option>
      </select>
    </form>
  </div>

  <!-- Tabla de proveedores -->
  <div class="table-container">
    <table class="data-table">

      <!-- Cabecera -->
      <thead>
      <tr>
        <th>
          <input
            type="checkbox"
            (change)="toggleAllSelection()"
            [checked]="isAllSelected()">
        </th>
        <th>ID</th>
        <th>NOMBRE/EMPRESA</th>
        <th>CIF/NIF</th>
        <th>CONTACTO</th>
        <th>EMAIL</th>
        <th>TEL√âFONO</th>
        <th>CIUDAD</th>
        <th>T√âRMINOS PAGO</th>
        <th>ESTADO</th>
        <th>ACCIONES</th>
      </tr>
      </thead>

      <!-- Cuerpo -->
      <tbody>
        @if (suppliers && suppliers.length > 0) {
          @for (supplier of suppliers; track supplier.id) {
            <tr [class.inactive-row]="!supplier.active">

              <td>
                <input
                  type="checkbox"
                  [checked]="selectedItems.has(supplier.id!)"
                  (change)="toggleSelection(supplier.id!)">
              </td>

              <!-- ID -->
              <td>#{{ supplier.id }}</td>

              <!-- Nombre/Empresa -->
              <td class="name-cell">
                <div class="name-display">
                  <span class="company-name">{{ getDisplayName(supplier) }}</span>
                  @if (supplier.company_name) {
                    <small class="person-name">{{ supplier.name }}</small>
                  }
                </div>
              </td>

              <!-- CIF/NIF -->
              <td class="tax-id-cell">{{ supplier.tax_id }}</td>

              <!-- Contacto -->
              <td class="contact-cell">{{ supplier.contact_person || '-' }}</td>

              <!-- Email -->
              <td class="email-cell">
                @if (supplier.email) {
                  <a [href]="'mailto:' + supplier.email">{{ supplier.email }}</a>
                } @else {
                  -
                }
              </td>

              <!-- Tel√©fono -->
              <td class="phone-cell">
                @if (supplier.phone) {
                  <a [href]="'tel:' + supplier.phone">{{ supplier.phone }}</a>
                } @else {
                  -
                }
              </td>

              <!-- Ciudad -->
              <td>{{ supplier.city || '-' }}</td>

              <!-- T√©rminos de pago -->
              <td class="payment-terms-cell">{{ supplier.payment_terms }} d√≠as</td>

              <!-- Estado -->
              <td>
                <span [ngClass]="getActiveStatusClass(supplier.active)">
                  {{ getActiveLabel(supplier.active) }}
                </span>
              </td>

              <!-- Acciones -->
              <td>
                <button class="action-btn edit-btn" (click)="editSupplier(supplier.id!)">
                  ‚úèÔ∏è Editar
                </button>

                @if (supplier.active) {
                  <button class="action-btn delete-btn" (click)="deleteSupplier(supplier.id!)">
                    üö´ Desactivar
                  </button>
                } @else {
                  <button class="action-btn activate-btn" (click)="activateSupplier(supplier.id!)">
                    ‚úÖ Activar
                  </button>
                }
              </td>
            </tr>
          }
        } @else {
          <tr>
            <td colspan="10" class="no-data">
              <div class="empty-state">
                <p>No se encontraron proveedores</p>
                <button type="button" class="primary-btn" (click)="createNewSupplier()">+ Nuevo Proveedor</button>
              </div>
            </td>
          </tr>
        }
      </tbody>

    </table>
  </div>

  <!-- Paginaci√≥n -->
  @if (paginationResult.totalPages > 1) {
    <div class="pagination-container">

      <!-- Informaci√≥n de resultados -->
      <div class="pagination-info">
        {{ getPaginationText() }}
      </div>

      <!-- Controles de paginaci√≥n -->
      <div class="pagination-controls">

        <!-- Bot√≥n anterior -->
        <button
          class="pagination-btn"
          [class.disabled]="!paginationResult.hasPrevious"
          (click)="previousPage()"
          [disabled]="!paginationResult.hasPrevious">
          ‚Äπ Anterior
        </button>

        <!-- N√∫meros de p√°gina -->
        @for (page of getVisiblePages(); track page) {
          <button
            class="pagination-btn"
            [class.active]="page === paginationConfig.currentPage"
            (click)="goToPage(page)">
            {{ page }}
          </button>
        }

        <!-- Puntos suspensivos -->
        @if (paginationResult.totalPages > 5 && paginationConfig.currentPage < paginationResult.totalPages - 2) {
          <span class="pagination-dots">...</span>
          <button
            class="pagination-btn"
            (click)="goToPage(paginationResult.totalPages)">
            {{ paginationResult.totalPages }}
          </button>
        }

        <!-- Bot√≥n siguiente -->
        <button
          class="pagination-btn"
          [class.disabled]="!paginationResult.hasNext"
          (click)="nextPage()"
          [disabled]="!paginationResult.hasNext">
          Siguiente ‚Ä∫
        </button>

      </div>
    </div>
  }
</div>
